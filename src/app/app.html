<div class="layout">
  <!-- LEFT: Tree (groups always visible) -->
  <aside class="sidenav">
    <mat-tree #tree [dataSource]="treeData" [childrenAccessor]="childrenAccessor">

      <!-- Leaf: selectable item OR placeholder -->
      <mat-tree-node
        *matTreeNodeDef="let node"
        matTreeNodePadding
        class="mat-tree-node tree-node"
        [class.selectable]="isSelectable(node)"
        [class.selected]="isSelectable(node) && isSelected(node)"
        [attr.aria-selected]="isSelectable(node) ? isSelected(node) : null"
        [attr.tabindex]="isSelectable(node) ? 0 : -1"
        (click)="selectNode(node)"
        (keydown.enter)="selectNode(node)"
        (keydown.space)="selectNode(node)">
        <button matIconButton disabled></button>
        <span class="label" [style.opacity]="node.placeholder ? 0.6 : 1">
          {{ node.name }}
        </span>
      </mat-tree-node>

      <!-- Expandable group: Tables / Views (NOT selectable) -->
      <mat-tree-node
        *matTreeNodeDef="let node; when: hasChild"
        matTreeNodePadding
        matTreeNodeToggle
        class="mat-tree-node tree-node"
        [cdkTreeNodeTypeaheadLabel]="node.name"
        [attr.tabindex]="-1">
        <button
          matIconButton
          matTreeNodeToggle
          (click)="$event.stopPropagation()"
          [attr.aria-label]="'Toggle ' + node.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{ tree.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
          </mat-icon>
        </button>
        <span class="label">{{ node.name }}</span>
      </mat-tree-node>

    </mat-tree>
  </aside>

  <!-- RIGHT: Dynamic grid + paginator -->
  <section class="content" style="position: relative;">
    @if (loading()) {
      <app-loading-indicator/>
    }

    <div class="table-container mat-elevation-z8">
      <table mat-table [dataSource]="rows">
        @for (col of columns; track col) {
          <ng-container [matColumnDef]="col">
            <th mat-header-cell *matHeaderCellDef sticky>{{ col }}</th>
            <td mat-cell *matCellDef="let row">{{ row[col] }}</td>
          </ng-container>
        }
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <mat-paginator
      [length]="total"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [hidePageSize]="true"
      showFirstLastButtons
      class="footer-paginator"
      (page)="onPage($event)">
    </mat-paginator>
  </section>
</div>
