<div class="layout">
  <!-- LEFT: Tree (leaf-only selectable) -->
  <aside class="sidenav">
    <mat-tree #tree [dataSource]="treeData" [childrenAccessor]="childrenAccessor">

      <!-- Leaf: selectable -->
      <mat-tree-node
        *matTreeNodeDef="let node"
        matTreeNodePadding
        class="mat-tree-node tree-node selectable"
        [class.selected]="isSelected(node)"
        [attr.aria-selected]="isSelected(node)"
        tabindex="0"
        (click)="selectNode(node)"
        (keydown.enter)="selectNode(node)"
        (keydown.space)="selectNode(node)">
        <button matIconButton disabled></button>
        <span class="label">{{ node.name }}</span>
      </mat-tree-node>

      <!-- Expandable: NOT selectable at top level -->
      <mat-tree-node
        *matTreeNodeDef="let node; when: hasChild"
        matTreeNodePadding
        matTreeNodeToggle
        class="mat-tree-node tree-node"
        [class.selectable]="isSelectable(node)"
        [class.selected]="isSelectable(node) && isSelected(node)"
        [cdkTreeNodeTypeaheadLabel]="node.name"
        [attr.aria-selected]="isSelectable(node) ? isSelected(node) : null"
        [attr.tabindex]="isSelectable(node) ? 0 : -1"
        (click)="selectNode(node)"
        (keydown.enter)="selectNode(node)"
        (keydown.space)="selectNode(node)">
        <button
          matIconButton
          matTreeNodeToggle
          (click)="$event.stopPropagation()"
          [attr.aria-label]="'Toggle ' + node.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{ tree.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
          </mat-icon>
        </button>
        <span class="label">{{ node.name }}</span>
      </mat-tree-node>

    </mat-tree>
  </aside>

  <!-- RIGHT: Dynamic grid + paginator -->
  <section class="content">
    <div class="table-container mat-elevation-z8">
      <table mat-table [dataSource]="dataSource">
        <!-- Generate all columns dynamically -->
        @for (col of columns; track col.key) {
          <ng-container [matColumnDef]="col.key">
            <th
              mat-header-cell
              *matHeaderCellDef
              sticky
              [style.width.px]="col.widthPx"
              [style.text-align]="col.align ?? 'start'">
              {{ col.label }}
            </th>

            <td
              mat-cell
              *matCellDef="let row"
              [style.text-align]="col.align ?? 'start'">
              {{ row[col.key] }}
            </td>
          </ng-container>
        }


        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <mat-paginator
      [length]="dataSource.data.length"
      [pageSize]="pageSize"
      [hidePageSize]="true"
      showFirstLastButtons
      class="footer-paginator">
    </mat-paginator>
  </section>
</div>
